#!/bin/sh

set -e

BUILD_DIR=$1

echo "-----> Installing libpostal"

# Create installation directories
INSTALL_DIR="$HOME/.heroku/personal-libpostal"
mkdir -p "$INSTALL_DIR/lib/pkgconfig"
mkdir -p "$INSTALL_DIR/include"

# Download precompiled libpostal binaries
curl -L https://github.com/openvenues/libpostal/releases/download/v1.1.0/libpostal-1.1.0-linux.tar.gz | tar xz -C "$INSTALL_DIR"

# Create pkg-config file
cat <<EOF > "$INSTALL_DIR/lib/pkgconfig/libpostal.pc"
prefix=$INSTALL_DIR
libdir=\${prefix}/lib
includedir=\${prefix}/include

Name: libpostal
Description: A library for parsing street addresses
Version: 1.1.0
Libs: -L\${libdir} -llibpostal
Cflags: -I\${includedir}
EOF

echo "-----> libpostal installed"
