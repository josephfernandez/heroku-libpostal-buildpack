#!/bin/sh

BUILD_DIR=$1
CACHE_DIR=$CACHE_DIR

echo "-----> Installing libpostal"

# Update package lists and install dependencies
apt-get update
apt-get install -y build-essential curl pkg-config cmake

# Download and install libpostal
curl -LO https://github.com/openvenues/libpostal/archive/refs/tags/v1.0.0.tar.gz
tar -xzf v1.0.0.tar.gz
cd libpostal-1.0.0

# Create a build directory and configure
mkdir -p build
cd build
cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local

# Build and install
make
make install

# Ensure pkg-config can find libpostal
echo "/usr/local/lib/pkgconfig" >> /etc/ld.so.conf.d/libpostal.conf
ldconfig

# Cleanup
cd ../../
rm -rf libpostal-1.0.0 v1.0.0.tar.gz

echo "-----> libpostal installed"
